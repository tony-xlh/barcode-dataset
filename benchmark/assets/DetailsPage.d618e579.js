import{Q as qe,d as Ne}from"./QBtnDropdown.3b8fa41b.js";import{c as ke,u as Ce,h as Oe,f as be,Q as fe}from"./QBtn.e082b33e.js";import{u as Qe,Q as me}from"./use-meta.23581ca9.js";import{a as Le,h as p,T as Ve,ab as Ue,r as g,c as O,w as he,B as Q,ac as je,g as Ge,I as Pe,q as Me,u as Ae,o as He,t as c,N as _,M as s,y as r,P as G,z as H,x as d,R as X,ad as ye,Q as F,O as z,v as J,a7 as _e}from"./index.b2fec18c.js";import{h as Fe,k as ze,K as pe,q as Je,z as te,Q as $,A as M,B as xe,D as $e,C as Ke,E as Z}from"./ClosePopup.f84c76ad.js";import{e as Ye,f as We,Q as we,l as B,B as Xe,g as ee,q as Ze,t as et,v as tt,w as at,d as Se,o as nt,b as lt,c as Te,n as ot,C as it}from"./utils.a1691bf9.js";import"./scroll.4c3c8bf4.js";var st=ke({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:D,emit:f}){let u=!1,h,x,y=null,I=null,b,S;function v(){h&&h(),h=null,u=!1,y!==null&&(clearTimeout(y),y=null),I!==null&&(clearTimeout(I),I=null),x!==void 0&&x.removeEventListener("transitionend",b),b=null}function w(o,m,C){m!==void 0&&(o.style.height=`${m}px`),o.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,u=!0,h=C}function k(o,m){o.style.overflowY=null,o.style.height=null,o.style.transition=null,v(),m!==S&&f(m)}function V(o,m){let C=0;x=o,u===!0?(v(),C=o.offsetHeight===o.scrollHeight?0:void 0):(S="hide",o.style.overflowY="hidden"),w(o,C,m),y=setTimeout(()=>{y=null,o.style.height=`${o.scrollHeight}px`,b=T=>{I=null,(Object(T)!==T||T.target===o)&&k(o,"show")},o.addEventListener("transitionend",b),I=setTimeout(b,a.duration*1.1)},100)}function E(o,m){let C;x=o,u===!0?v():(S="show",o.style.overflowY="hidden",C=o.scrollHeight),w(o,C,m),y=setTimeout(()=>{y=null,o.style.height=0,b=T=>{I=null,(Object(T)!==T||T.target===o)&&k(o,"hide")},o.addEventListener("transitionend",b),I=setTimeout(b,a.duration*1.1)},100)}return Le(()=>{u===!0&&v()}),()=>p(Ve,{css:!1,appear:a.appear,onEnter:V,onLeave:E},D.default)}});const P=Ue({}),ut=Object.keys(Ce);var Ie=ke({name:"QExpansionItem",props:{...Ce,...Fe,...Ye,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...ze,"click","afterShow","afterHide"],setup(a,{slots:D,emit:f}){const{proxy:{$q:u}}=Ge(),h=We(a,u),x=g(a.modelValue!==null?a.modelValue:a.defaultOpened),y=g(null),I=pe(),{show:b,hide:S,toggle:v}=Je({showing:x});let w,k;const V=O(()=>`q-expansion-item q-item-type q-expansion-item--${x.value===!0?"expanded":"collapsed"} q-expansion-item--${a.popup===!0?"popup":"standard"}`),E=O(()=>{if(a.contentInsetLevel===void 0)return null;const l=u.lang.rtl===!0?"Right":"Left";return{["padding"+l]:a.contentInsetLevel*56+"px"}}),o=O(()=>a.disable!==!0&&(a.href!==void 0||a.to!==void 0&&a.to!==null&&a.to!=="")),m=O(()=>{const l={};return ut.forEach(L=>{l[L]=a[L]}),l}),C=O(()=>o.value===!0||a.expandIconToggle!==!0),T=O(()=>a.expandedIcon!==void 0&&x.value===!0?a.expandedIcon:a.expandIcon||u.iconSet.expansionItem[a.denseToggle===!0?"denseIcon":"icon"]),K=O(()=>a.disable!==!0&&(o.value===!0||a.expandIconToggle===!0)),U=O(()=>({expanded:x.value===!0,detailsId:a.targetUid,toggle:v,show:b,hide:S})),q=O(()=>{const l=a.toggleAriaLabel!==void 0?a.toggleAriaLabel:u.lang.label[x.value===!0?"collapse":"expand"](a.label);return{role:"button","aria-expanded":x.value===!0?"true":"false","aria-controls":I,"aria-label":l}});he(()=>a.group,l=>{k!==void 0&&k(),l!==void 0&&ne()});function ae(l){o.value!==!0&&v(l),f("click",l)}function Y(l){l.keyCode===13&&W(l,!0)}function W(l,L){L!==!0&&y.value!==null&&y.value.focus(),v(l),Pe(l)}function oe(){f("afterShow")}function ie(){f("afterHide")}function ne(){w===void 0&&(w=pe()),x.value===!0&&(P[a.group]=w);const l=he(x,A=>{A===!0?P[a.group]=w:P[a.group]===w&&delete P[a.group]}),L=he(()=>P[a.group],(A,ve)=>{ve===w&&A!==void 0&&A!==w&&S()});k=()=>{l(),L(),P[a.group]===w&&delete P[a.group],k=void 0}}function se(){const l={class:[`q-focusable relative-position cursor-pointer${a.denseToggle===!0&&a.switchToggleSide===!0?" items-end":""}`,a.expandIconClass],side:a.switchToggleSide!==!0,avatar:a.switchToggleSide},L=[p(be,{class:"q-expansion-item__toggle-icon"+(a.expandedIcon===void 0&&x.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:T.value})];return K.value===!0&&(Object.assign(l,{tabindex:0,...q.value,onClick:W,onKeyup:Y}),L.unshift(p("div",{ref:y,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),p(M,l,()=>L)}function ue(){let l;return D.header!==void 0?l=[].concat(D.header(U.value)):(l=[p(M,()=>[p($,{lines:a.labelLines},()=>a.label||""),a.caption?p($,{lines:a.captionLines,caption:!0},()=>a.caption):null])],a.icon&&l[a.switchToggleSide===!0?"push":"unshift"](p(M,{side:a.switchToggleSide===!0,avatar:a.switchToggleSide!==!0},()=>p(be,{name:a.icon})))),a.disable!==!0&&a.hideExpandIcon!==!0&&l[a.switchToggleSide===!0?"unshift":"push"](se()),l}function re(){const l={ref:"item",style:a.headerStyle,class:a.headerClass,dark:h.value,disable:a.disable,dense:a.dense,insetLevel:a.headerInsetLevel};return C.value===!0&&(l.clickable=!0,l.onClick=ae,Object.assign(l,o.value===!0?m.value:q.value)),p(te,l,ue)}function de(){return Q(p("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:E.value,id:I},Oe(D.default)),[[je,x.value]])}function ce(){const l=[re(),p(st,{duration:a.duration,onShow:oe,onHide:ie},de)];return a.expandSeparator===!0&&l.push(p(we,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:h.value}),p(we,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:h.value})),l}return a.group!==void 0&&ne(),Le(()=>{k!==void 0&&k()}),()=>p("div",{class:V.value},[p("div",{class:"q-expansion-item__container relative-position"},ce())])}});const rt={class:"q-pa-md example-row-equal-width"},dt={class:"row"},ct={class:"col-12 col-md",style:{"padding-right":"10px"}},vt={style:{"padding-bottom":"20px"}},gt={style:{"padding-left":"10px"}},ft={class:"row results"},mt={class:"col"},ht={class:"col"},xt={class:"col-12 col-md"},bt={style:{display:"flex"}},yt={key:0},_t=s("div",{style:{flex:"1"}},null,-1),pt={style:{"max-height":"75vh",overflow:"auto"}},wt=["viewBox"],St=["href"],Tt={key:0},It=["points"],kt={key:1},Ct=["points","onMousedown"],Lt=["x","y","font-size"],Rt={key:2},Bt=["cx","cy"],Dt={class:"row"},Et={class:"dialogs"},qt=s("div",{class:"text-h6"},"Edit Ground Truth",-1),Nt=s("div",null,[s("label",{for:"ground-truth-format"},"Format:")],-1),Ot=s("div",null,[s("label",{for:"ground-truth-text"},"Text:")],-1),At=Me({__name:"DetailsPage",setup(a){const D=Ae(),f=g(""),u=g(""),h=g(""),x=g([]),y=g(0),I=g(0),b=g(""),S=g([]),v=g([]),w=g(!0),k=g(!0),V=g(!1),E=g(""),o=g([]),m=g(!1),C=g(),T=g([]),K=g(!1),U=g(-1);let q;He(()=>{f.value=D.currentRoute.value.params.name,u.value=D.currentRoute.value.params.imageName,h.value=D.currentRoute.value.params.engine;const n=Se.getEngines();x.value=n,Qe({title:"Barcode Reading Benchmark - "+f.value+" - "+u.value}),ae(),Y(D.currentRoute.value.params.engine)});const ae=async()=>{const n=await B.getItem(f.value+":image:"+u.value);if(n){let e=new Image;e.src=n,e.onload=function(){y.value=e.width,I.value=e.height,b.value=n}}else{const t=await(await fetch("./dataset/"+f.value+"/"+u.value)).blob();if(t.size>0){const i=await Xe(t);await B.setItem(f.value+":image:"+u.value,i),ae()}}},Y=async(n,e)=>{let t;if(n?t=n:t=h.value,e)S.value=e.results;else{const N=await B.getItem(f.value+":detectionResult:"+ee(u.value)+"-"+t+".json");N?(e=JSON.parse(N),e&&(S.value=e.results)):S.value=[]}const i=await B.getItem(f.value+":groundTruth:"+ee(u.value)+".txt");let R;i&&(R=JSON.parse(i),v.value=R),e&&i&&ne(e.results,R)},W=n=>{let e=n.x1+","+n.y1+" ";return e=e+n.x2+","+n.y2+" ",e=e+n.x3+","+n.y3+" ",e=e+n.x4+","+n.y4,e},oe=async()=>{let n=!1;q?q.getEngine()!=h.value&&(n=!0):n=!0,n&&(E.value="Initializing...",q=await Se.createInstance(h.value),E.value=""),await ie();const e=await B.getItem(f.value+":image:"+u.value);if(e){E.value="Decoding...";let t=await q.detect(e);E.value="",console.log(t),S.value=t.results,V.value===!0&&await B.setItem(f.value+":detectionResult:"+ee(u.value)+"-"+h.value+".json",JSON.stringify(t)),Y(h.value,t)}},ie=async()=>{const n=await nt(f.value,h.value,q.getSupportedSettings());await q.setSupportedSettings(n)},ne=(n,e)=>{let t=[];for(let i=0;i<n.length;i++){const R=n[i];let N=!1;for(let j=0;j<e.length;j++){const le=e[j];let ge;if(le.hasLocation===!1)ge=1;else{const De=Ze(R),Ee=et(le);ge=tt(De,Ee)}if(ge>0){le.text&&(at(le,R)?N=!0:t.push(i));continue}j===e.length-1&&N===!1&&t.push(i)}}o.value=t},se=n=>{Y(n)},ue=async()=>{B.removeItem(f.value+":image:"+u.value),B.removeItem(f.value+":groundTruth:"+ee(u.value)+".txt");const n=await B.getItem("projects");if(n){const e=JSON.parse(n);for(let t=0;t<e.length;t++)if(e[t].info.name===f.value){const i=e[t],R=[];for(let N=0;N<i.info.images.length;N++){const j=i.info.images[N];j!=u.value&&R.push(j)}i.info.images=R}await B.setItem("projects",JSON.stringify(e)),alert("deleted")}},re=()=>{if(b.value){const n=ot(b.value),e=document.createElement("a");e.href=URL.createObjectURL(n),e.download=u.value,document.body.appendChild(e),e.click(),document.body.removeChild(e)}else alert("The image has not been downloaded.")},de=()=>{m.value=!m.value},ce=()=>{v.value=it(S.value)},l=async()=>{await B.setItem(f.value+":groundTruth:"+ee(u.value)+".txt",JSON.stringify(v.value)),alert("Saved")},L=n=>(n.preventDefault(),!1),A=(n,e)=>{let t=1;return t=y.value/C.value.clientWidth,{x:Math.floor(t*n),y:Math.floor(t*e)}},ve=(n,e)=>{m.value&&(n.stopPropagation(),U.value=e,K.value=!0)},Re=n=>{if(m.value){const e=[];if(T.value.forEach(t=>{e.push(t)}),n.button==2)n.preventDefault(),e.pop();else if(e.push(A(n.offsetX,n.offsetY)),e.length>=4){Be(e);return}T.value=e}},Be=n=>{const e=[],t={x1:n[0].x,x2:n[1].x,x3:n[2].x,x4:n[3].x,y1:n[0].y,y2:n[1].y,y3:n[2].y,y4:n[3].y,text:"",attrib:{Type:""},value_attrib:{}};v.value.forEach(i=>{e.push(i)}),e.push(t),v.value=e,T.value=[]};return(n,e)=>(c(),_("div",rt,[s("div",dt,[s("div",ct,[s("div",vt,[r(qe,{"onUpdate:modelValue":[e[0]||(e[0]=t=>se(t)),e[1]||(e[1]=t=>h.value=t)],style:{"max-width":"300px"},modelValue:h.value,options:x.value,label:"Engine"},null,8,["modelValue","options"])]),s("div",null,[r(fe,{outline:"",color:"primary",label:"Decode",onClick:oe}),r(me,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),label:"Save Detection Results"},null,8,["modelValue"]),s("span",gt,G(E.value),1)]),s("div",null,[r(me,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),label:"Show Detection Results"},null,8,["modelValue"])]),s("div",null,[r(me,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),label:"Show Ground Trurh"},null,8,["modelValue"])]),s("div",ft,[s("div",mt,[H(" Barcode Results: "),r(xe,{bordered:"",class:"rounded-borders"},{default:d(()=>[(c(!0),_(F,null,z(S.value,(t,i)=>(c(),J(Ie,{class:ye(o.value.indexOf(i)!=-1?"incorrect":"correct"),"switch-toggle-side":"","dense-toggle":"",label:i.toString()+": "+t.barcodeText,key:i},{default:d(()=>[s("pre",null,""+G(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["class","label"]))),128))]),_:1})]),s("div",ht,[H(" Ground Truth: "),r(xe,{bordered:"",class:"rounded-borders"},{default:d(()=>[(c(!0),_(F,null,z(v.value,(t,i)=>(c(),J(Ie,{"switch-toggle-side":"","dense-toggle":"",label:i.toString()+": "+t.text,key:i},{default:d(()=>[s("pre",null,""+G(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["label"]))),128))]),_:1})])])]),s("div",xt,[s("div",bt,[b.value?X("",!0):(c(),_("div",yt,"Downloading... ")),_t,s("div",null,[r(Ne,{color:"primary",label:"Action"},{default:d(()=>[r(xe,null,{default:d(()=>[Q((c(),J(te,{clickable:"",onClick:re},{default:d(()=>[r(M,null,{default:d(()=>[r($,null,{default:d(()=>[H("Save the image")]),_:1})]),_:1})]),_:1})),[[Z]]),Q((c(),J(te,{clickable:"",onClick:de},{default:d(()=>[r(M,null,{default:d(()=>[r($,null,{default:d(()=>[H(G(m.value?"Disable":"Enable")+" annotation",1)]),_:1})]),_:1})]),_:1})),[[Z]]),Q((c(),J(te,{clickable:"",onClick:ce},{default:d(()=>[r(M,null,{default:d(()=>[r($,null,{default:d(()=>[H("Convert detected results to ground truth")]),_:1})]),_:1})]),_:1})),[[Z]]),Q((c(),J(te,{clickable:"",onClick:l},{default:d(()=>[r(M,null,{default:d(()=>[r($,null,{default:d(()=>[H("Save modified ground truth")]),_:1})]),_:1})]),_:1})),[[Z]])]),_:1})]),_:1})])]),s("div",pt,[b.value?(c(),_("svg",{key:0,viewBox:"0 0 "+y.value+" "+I.value,ref_key:"svgRef",ref:C,class:ye("fade"+(m.value?" annotator":"")),onContextmenu:e[5]||(e[5]=t=>L(t)),onMousedown:e[6]||(e[6]=t=>Re(t))},[s("image",{href:b.value},null,8,St),w.value?(c(),_("a",Tt,[(c(!0),_(F,null,z(S.value,(t,i)=>(c(),_("polygon",{key:"polygon"+i,points:W(t),class:"barcode-polygon"},[s("title",null,G(t.barcodeFormat+": "+t.barcodeText),1)],8,It))),128))])):X("",!0),k.value?(c(),_("a",kt,[(c(!0),_(F,null,z(v.value,(t,i)=>(c(),_("polygon",{key:"polygon"+i,points:W(t),class:"groundtruth-polygon",onMousedown:R=>ve(R,i)},[s("title",null,G(t.attrib.Type+": "+t.text),1)],40,Ct))),128)),(c(!0),_(F,null,z(v.value,(t,i)=>(c(),_("text",{key:"text"+i,x:t.x1,y:t.y1,"font-size":16/(640/y.value),class:"barcodeTypeLabel"},G(t.attrib.Type),9,Lt))),128))])):X("",!0),m.value?(c(),_("a",Rt,[(c(!0),_(F,null,z(T.value,(t,i)=>(c(),_("circle",{key:"point"+i,cx:t.x,cy:t.y},null,8,Bt))),128))])):X("",!0)],42,wt)):X("",!0)])])]),s("div",Dt,[r(fe,{outline:"",color:"red",label:"Delete this image",onClick:ue})]),s("div",Et,[r($e,{modelValue:K.value,"onUpdate:modelValue":e[9]||(e[9]=t=>K.value=t)},{default:d(()=>[r(lt,null,{default:d(()=>[r(Te,null,{default:d(()=>[qt]),_:1}),r(Te,{class:"q-pt-none"},{default:d(()=>[s("div",null,[Nt,s("div",null,[Q(s("input",{type:"text",id:"'ground-truth-format","onUpdate:modelValue":e[7]||(e[7]=t=>v.value[U.value].attrib.Type=t)},null,512),[[_e,v.value[U.value].attrib.Type]])]),Ot,s("div",null,[Q(s("textarea",{id:"'ground-truth-text","onUpdate:modelValue":e[8]||(e[8]=t=>v.value[U.value].text=t)},null,512),[[_e,v.value[U.value].text]])])])]),_:1}),r(Ke,{align:"right"},{default:d(()=>[Q(r(fe,{flat:"",color:"primary",label:"Close"},null,512),[[Z]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}});export{At as default};
