import{u as Oe,Q as fe}from"./use-meta.78449197.js";import{a as ke,h as p,T as qe,ag as Ne,r as g,c as N,w as he,I as Q,ah as Qe,g as Ue,J as Ve,q as je,u as Ge,o as Pe,t as r,O as x,B as o,ad as Me,P,Q as M,y as d,R as U,x as c,U as W,a5 as be,v as J,S as le,ae as xe}from"./index.609c439b.js";import{e as _e,d as ee,c as z,b as H,Q as me,f as Ae}from"./QSeparator.0fd2b586.js";import{c as Ce,h as He,Q as ye}from"./QIcon.605f024d.js";import{b as Fe,c as Je}from"./use-form.2ed0f0fe.js";import{h as Le,Q as pe}from"./QBtn.4f0904a6.js";import{b as ze,e as $e,w as we,k as Ye,Q as Ke,o as We,q as Se,t as Xe,C as X}from"./ClosePopup.7dc21bf1.js";import{l as B,B as Ze,g as Z,j as et,k as tt,m as at,t as nt,D as lt,a as Te,i as ot,h as st,C as it}from"./DynamsoftButton.bbdbe840.js";import"./scroll.292e9062.js";var ut=Ce({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:D,emit:f}){let u=!1,m,b,y=null,I=null,_,S;function v(){m&&m(),m=null,u=!1,y!==null&&(clearTimeout(y),y=null),I!==null&&(clearTimeout(I),I=null),b!==void 0&&b.removeEventListener("transitionend",_),_=null}function w(s,h,C){h!==void 0&&(s.style.height=`${h}px`),s.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,u=!0,m=C}function k(s,h){s.style.overflowY=null,s.style.height=null,s.style.transition=null,v(),h!==S&&f(h)}function V(s,h){let C=0;b=s,u===!0?(v(),C=s.offsetHeight===s.scrollHeight?0:void 0):(S="hide",s.style.overflowY="hidden"),w(s,C,h),y=setTimeout(()=>{y=null,s.style.height=`${s.scrollHeight}px`,_=T=>{I=null,(Object(T)!==T||T.target===s)&&k(s,"show")},s.addEventListener("transitionend",_),I=setTimeout(_,a.duration*1.1)},100)}function E(s,h){let C;b=s,u===!0?v():(S="show",s.style.overflowY="hidden",C=s.scrollHeight),w(s,C,h),y=setTimeout(()=>{y=null,s.style.height=0,_=T=>{I=null,(Object(T)!==T||T.target===s)&&k(s,"hide")},s.addEventListener("transitionend",_),I=setTimeout(_,a.duration*1.1)},100)}return ke(()=>{u===!0&&v()}),()=>p(qe,{css:!1,appear:a.appear,onEnter:V,onLeave:E},D.default)}});const A=Ne({}),rt=Object.keys(Le);var Ie=Ce({name:"QExpansionItem",props:{...Le,...ze,...Fe,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...$e,"click","afterShow","afterHide"],setup(a,{slots:D,emit:f}){const{proxy:{$q:u}}=Ue(),m=Je(a,u),b=g(a.modelValue!==null?a.modelValue:a.defaultOpened),y=g(null),I=we(),{show:_,hide:S,toggle:v}=Ye({showing:b});let w,k;const V=N(()=>`q-expansion-item q-item-type q-expansion-item--${b.value===!0?"expanded":"collapsed"} q-expansion-item--${a.popup===!0?"popup":"standard"}`),E=N(()=>{if(a.contentInsetLevel===void 0)return null;const l=u.lang.rtl===!0?"Right":"Left";return{["padding"+l]:a.contentInsetLevel*56+"px"}}),s=N(()=>a.disable!==!0&&(a.href!==void 0||a.to!==void 0&&a.to!==null&&a.to!=="")),h=N(()=>{const l={};return rt.forEach(L=>{l[L]=a[L]}),l}),C=N(()=>s.value===!0||a.expandIconToggle!==!0),T=N(()=>a.expandedIcon!==void 0&&b.value===!0?a.expandedIcon:a.expandIcon||u.iconSet.expansionItem[a.denseToggle===!0?"denseIcon":"icon"]),$=N(()=>a.disable!==!0&&(s.value===!0||a.expandIconToggle===!0)),j=N(()=>({expanded:b.value===!0,detailsId:a.targetUid,toggle:v,show:_,hide:S})),O=N(()=>{const l=a.toggleAriaLabel!==void 0?a.toggleAriaLabel:u.lang.label[b.value===!0?"collapse":"expand"](a.label);return{role:"button","aria-expanded":b.value===!0?"true":"false","aria-controls":I,"aria-label":l}});he(()=>a.group,l=>{k!==void 0&&k(),l!==void 0&&ae()});function te(l){s.value!==!0&&v(l),f("click",l)}function Y(l){l.keyCode===13&&K(l,!0)}function K(l,L){L!==!0&&y.value!==null&&y.value.focus(),v(l),Ve(l)}function oe(){f("afterShow")}function se(){f("afterHide")}function ae(){w===void 0&&(w=we()),b.value===!0&&(A[a.group]=w);const l=he(b,F=>{F===!0?A[a.group]=w:A[a.group]===w&&delete A[a.group]}),L=he(()=>A[a.group],(F,ve)=>{ve===w&&F!==void 0&&F!==w&&S()});k=()=>{l(),L(),A[a.group]===w&&delete A[a.group],k=void 0}}function ie(){const l={class:[`q-focusable relative-position cursor-pointer${a.denseToggle===!0&&a.switchToggleSide===!0?" items-end":""}`,a.expandIconClass],side:a.switchToggleSide!==!0,avatar:a.switchToggleSide},L=[p(ye,{class:"q-expansion-item__toggle-icon"+(a.expandedIcon===void 0&&b.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:T.value})];return $.value===!0&&(Object.assign(l,{tabindex:0,...O.value,onClick:K,onKeyup:Y}),L.unshift(p("div",{ref:y,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),p(H,l,()=>L)}function ue(){let l;return D.header!==void 0?l=[].concat(D.header(j.value)):(l=[p(H,()=>[p(z,{lines:a.labelLines},()=>a.label||""),a.caption?p(z,{lines:a.captionLines,caption:!0},()=>a.caption):null])],a.icon&&l[a.switchToggleSide===!0?"push":"unshift"](p(H,{side:a.switchToggleSide===!0,avatar:a.switchToggleSide!==!0},()=>p(ye,{name:a.icon})))),a.disable!==!0&&a.hideExpandIcon!==!0&&l[a.switchToggleSide===!0?"unshift":"push"](ie()),l}function re(){const l={ref:"item",style:a.headerStyle,class:a.headerClass,dark:m.value,disable:a.disable,dense:a.dense,insetLevel:a.headerInsetLevel};return C.value===!0&&(l.clickable=!0,l.onClick=te,Object.assign(l,s.value===!0?h.value:O.value)),p(ee,l,ue)}function de(){return Q(p("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:E.value,id:I},He(D.default)),[[Qe,b.value]])}function ce(){const l=[re(),p(ut,{duration:a.duration,onShow:oe,onHide:se},de)];return a.expandSeparator===!0&&l.push(p(_e,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:m.value}),p(_e,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:m.value})),l}return a.group!==void 0&&ae(),ke(()=>{k!==void 0&&k()}),()=>p("div",{class:V.value},[p("div",{class:"q-expansion-item__container relative-position"},ce())])}});const dt={class:"q-pa-md example-row-equal-width"},ct={class:"row"},vt={class:"col-12 col-md",style:{"padding-right":"10px"}},gt=o("div",null,[o("label",{style:{"font-size":"16px"}},"Engines:")],-1),ft={class:"row",style:{"padding-bottom":"20px"}},ht=["value"],mt={style:{"padding-left":"10px"}},bt={class:"row results"},xt={class:"col list"},_t=o("div",{class:"list-header"}," Barcode Results: ",-1),yt={class:"col list"},pt=o("div",{class:"list-header"}," Ground Truth: ",-1),wt={class:"col-12 col-md"},St={style:{display:"flex"}},Tt={key:0},It=o("div",{style:{flex:"1"}},null,-1),kt={style:{"max-height":"75vh",overflow:"auto"}},Ct=["viewBox"],Lt=["href"],Rt={key:0},Bt=["points"],Dt={key:1},Et=["points","onMousedown"],Ot=["x","y","font-size"],qt={key:2},Nt=["cx","cy"],Qt={class:"row"},Ut={class:"dialogs"},Vt=o("div",{class:"text-h6"},"Edit Ground Truth",-1),jt=o("div",null,[o("label",{for:"ground-truth-format"},"Format:")],-1),Gt=o("div",null,[o("label",{for:"ground-truth-text"},"Text:")],-1),Kt=je({__name:"DetailsPage",setup(a){const D=Ge(),f=g(""),u=g(""),m=g(""),b=g([]),y=g(0),I=g(0),_=g(""),S=g([]),v=g([]),w=g(!0),k=g(!0),V=g(!1),E=g(""),s=g([]),h=g(!1),C=g(),T=g([]),$=g(!1),j=g(-1);let O;Pe(()=>{f.value=D.currentRoute.value.params.name,u.value=D.currentRoute.value.params.imageName,m.value=D.currentRoute.value.params.engine;const n=Te.getEngines();b.value=n,Oe({title:"Barcode Reading Benchmark - "+f.value+" - "+u.value}),te(),Y(D.currentRoute.value.params.engine)});const te=async()=>{const n=await B.getItem(f.value+":image:"+u.value);if(n){let e=new Image;e.src=n,e.onload=function(){y.value=e.width,I.value=e.height,_.value=n}}else{const t=await(await fetch("./dataset/"+f.value+"/"+u.value)).blob();if(t.size>0){const i=await Ze(t);await B.setItem(f.value+":image:"+u.value,i),te()}}},Y=async(n,e)=>{let t;if(n?t=n:t=m.value,e)S.value=e.results;else{const q=await B.getItem(f.value+":detectionResult:"+Z(u.value)+"-"+t+".json");q?(e=JSON.parse(q),e&&(S.value=e.results)):S.value=[]}const i=await B.getItem(f.value+":groundTruth:"+Z(u.value)+".txt");let R;i&&(R=JSON.parse(i),v.value=R),e&&i&&ae(e.results,R)},K=n=>{let e=n.x1+","+n.y1+" ";return e=e+n.x2+","+n.y2+" ",e=e+n.x3+","+n.y3+" ",e=e+n.x4+","+n.y4,e},oe=async()=>{let n=!1;O?O.getEngine()!=m.value&&(n=!0):n=!0,n&&(E.value="Initializing...",O=await Te.createInstance(m.value),E.value=""),await se();const e=await B.getItem(f.value+":image:"+u.value);if(e){E.value="Decoding...";let t=await O.detect(e);E.value="",console.log(t),S.value=t.results,V.value===!0&&await B.setItem(f.value+":detectionResult:"+Z(u.value)+"-"+m.value+".json",JSON.stringify(t)),Y(m.value,t)}},se=async()=>{const n=await ot(f.value,m.value,O.getSupportedSettings());await O.setSupportedSettings(n)},ae=(n,e)=>{let t=[];for(let i=0;i<n.length;i++){const R=n[i];let q=!1;for(let G=0;G<e.length;G++){const ne=e[G];let ge;if(ne.hasLocation===!1)ge=1;else{const De=et(R),Ee=tt(ne);ge=at(De,Ee)}if(ge>0){ne.text&&(nt(ne,R)?q=!0:t.push(i));continue}G===e.length-1&&q===!1&&t.push(i)}}s.value=t},ie=n=>{Y(n)},ue=async()=>{B.removeItem(f.value+":image:"+u.value),B.removeItem(f.value+":groundTruth:"+Z(u.value)+".txt");const n=await B.getItem("projects");if(n){const e=JSON.parse(n);for(let t=0;t<e.length;t++)if(e[t].info.name===f.value){const i=e[t],R=[];for(let q=0;q<i.info.images.length;q++){const G=i.info.images[q];G!=u.value&&R.push(G)}i.info.images=R}await B.setItem("projects",JSON.stringify(e)),alert("deleted")}},re=()=>{if(_.value){const n=st(_.value),e=document.createElement("a");e.href=URL.createObjectURL(n),e.download=u.value,document.body.appendChild(e),e.click(),document.body.removeChild(e)}else alert("The image has not been downloaded.")},de=()=>{h.value=!h.value},ce=()=>{v.value=it(S.value)},l=async()=>{await B.setItem(f.value+":groundTruth:"+Z(u.value)+".txt",JSON.stringify(v.value)),alert("Saved")},L=n=>(n.preventDefault(),!1),F=(n,e)=>{let t=1;return t=y.value/C.value.clientWidth,{x:Math.floor(t*n),y:Math.floor(t*e)}},ve=(n,e)=>{h.value&&(n.stopPropagation(),j.value=e,$.value=!0)},Re=n=>{if(h.value){const e=[];if(T.value.forEach(t=>{e.push(t)}),n.button==2)n.preventDefault(),e.pop();else if(e.push(F(n.offsetX,n.offsetY)),e.length>=4){Be(e);return}T.value=e}},Be=n=>{const e=[],t={x1:n[0].x,x2:n[1].x,x3:n[2].x,x4:n[3].x,y1:n[0].y,y2:n[1].y,y3:n[2].y,y4:n[3].y,text:"",attrib:{Type:""},value_attrib:{}};v.value.forEach(i=>{e.push(i)}),e.push(t),v.value=e,T.value=[]};return(n,e)=>(r(),x("div",dt,[o("div",ct,[o("div",vt,[gt,o("div",ft,[Q(o("select",{"onUpdate:modelValue":[e[0]||(e[0]=t=>ie(t)),e[1]||(e[1]=t=>m.value=t)],style:{"min-width":"200px"}},[(r(!0),x(P,null,M(b.value,t=>(r(),x("option",{value:t,key:t},U(t),9,ht))),128))],512),[[Me,m.value]])]),o("div",null,[d(lt,{label:"Decode",onClick:oe}),d(fe,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),label:"Save Detection Results"},null,8,["modelValue"]),o("span",mt,U(E.value),1)]),o("div",null,[d(fe,{style:{"margin-right":"5px"},color:"orange",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),label:"Show Detection Results"},null,8,["modelValue"]),d(fe,{color:"orange",modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),label:"Show Ground Trurh"},null,8,["modelValue"])]),o("div",bt,[o("div",xt,[_t,d(me,{bordered:"",class:"rounded-borders"},{default:c(()=>[(r(!0),x(P,null,M(S.value,(t,i)=>(r(),J(Ie,{class:be(s.value.indexOf(i)!=-1?"incorrect":"correct"),"switch-toggle-side":"","dense-toggle":"",label:i.toString()+": "+t.barcodeText,key:i},{default:c(()=>[o("pre",null,""+U(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["class","label"]))),128))]),_:1})]),o("div",yt,[pt,d(me,{bordered:"",class:"rounded-borders"},{default:c(()=>[(r(!0),x(P,null,M(v.value,(t,i)=>(r(),J(Ie,{"switch-toggle-side":"","dense-toggle":"",label:i.toString()+": "+t.text,key:i},{default:c(()=>[o("pre",null,""+U(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["label"]))),128))]),_:1})])])]),o("div",wt,[o("div",St,[_.value?W("",!0):(r(),x("div",Tt,"Downloading... ")),It,o("div",null,[d(Ae,{color:"black",label:"Action"},{default:c(()=>[d(me,null,{default:c(()=>[Q((r(),J(ee,{clickable:"",onClick:re},{default:c(()=>[d(H,null,{default:c(()=>[d(z,null,{default:c(()=>[le("Save the image")]),_:1})]),_:1})]),_:1})),[[X]]),Q((r(),J(ee,{clickable:"",onClick:de},{default:c(()=>[d(H,null,{default:c(()=>[d(z,null,{default:c(()=>[le(U(h.value?"Disable":"Enable")+" annotation",1)]),_:1})]),_:1})]),_:1})),[[X]]),Q((r(),J(ee,{clickable:"",onClick:ce},{default:c(()=>[d(H,null,{default:c(()=>[d(z,null,{default:c(()=>[le("Convert detected results to ground truth")]),_:1})]),_:1})]),_:1})),[[X]]),Q((r(),J(ee,{clickable:"",onClick:l},{default:c(()=>[d(H,null,{default:c(()=>[d(z,null,{default:c(()=>[le("Save modified ground truth")]),_:1})]),_:1})]),_:1})),[[X]])]),_:1})]),_:1})])]),o("div",kt,[_.value?(r(),x("svg",{key:0,viewBox:"0 0 "+y.value+" "+I.value,ref_key:"svgRef",ref:C,class:be("fade"+(h.value?" annotator":"")),onContextmenu:e[5]||(e[5]=t=>L(t)),onMousedown:e[6]||(e[6]=t=>Re(t))},[o("image",{href:_.value},null,8,Lt),w.value?(r(),x("a",Rt,[(r(!0),x(P,null,M(S.value,(t,i)=>(r(),x("polygon",{key:"polygon"+i,points:K(t),class:"barcode-polygon"},[o("title",null,U(t.barcodeFormat+": "+t.barcodeText),1)],8,Bt))),128))])):W("",!0),k.value?(r(),x("a",Dt,[(r(!0),x(P,null,M(v.value,(t,i)=>(r(),x("polygon",{key:"polygon"+i,points:K(t),class:"groundtruth-polygon",onMousedown:R=>ve(R,i)},[o("title",null,U(t.attrib.Type+": "+t.text),1)],40,Et))),128)),(r(!0),x(P,null,M(v.value,(t,i)=>(r(),x("text",{key:"text"+i,x:t.x1,y:t.y1,"font-size":16/(640/y.value),class:"barcodeTypeLabel"},U(t.attrib.Type),9,Ot))),128))])):W("",!0),h.value?(r(),x("a",qt,[(r(!0),x(P,null,M(T.value,(t,i)=>(r(),x("circle",{key:"point"+i,cx:t.x,cy:t.y},null,8,Nt))),128))])):W("",!0)],42,Ct)):W("",!0)])])]),o("div",Qt,[d(pe,{outline:"",color:"red",label:"Delete this image",onClick:ue})]),o("div",Ut,[d(Ke,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=t=>$.value=t)},{default:c(()=>[d(We,null,{default:c(()=>[d(Se,null,{default:c(()=>[Vt]),_:1}),d(Se,{class:"q-pt-none"},{default:c(()=>[o("div",null,[jt,o("div",null,[Q(o("input",{type:"text",id:"'ground-truth-format","onUpdate:modelValue":e[7]||(e[7]=t=>v.value[j.value].attrib.Type=t)},null,512),[[xe,v.value[j.value].attrib.Type]])]),Gt,o("div",null,[Q(o("textarea",{id:"'ground-truth-text","onUpdate:modelValue":e[8]||(e[8]=t=>v.value[j.value].text=t)},null,512),[[xe,v.value[j.value].text]])])])]),_:1}),d(Xe,{align:"right"},{default:c(()=>[Q(d(pe,{flat:"",color:"primary",label:"Close"},null,512),[[X]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}});export{Kt as default};
