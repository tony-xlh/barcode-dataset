import{u as Ee,Q as fe}from"./use-meta.eb4133b6.js";import{o as Ie,h as _,X as Oe,ag as Qe,r as v,c as O,w as me,E as Q,ah as qe,g as je,U as Pe,s as Ve,u as Ge,d as Me,v as r,J as b,A as s,ae as Ue,L as M,M as U,z as d,N as j,y as c,K as Y,a6 as be,x as J,O as le,ai as xe}from"./index.c9d13e01.js";import{d as Z,c as $,b as H,Q as he}from"./QMenu.fbc5a94f.js";import{h as ke,c as ye,Q as _e}from"./QBtn.59d7652d.js";import{c as Ce,h as Ae}from"./dom.39abbeda.js";import{Q as pe}from"./QSeparator.2f04d1e9.js";import{f as He,y as ze,i as Fe,z as Je,x as we,o as $e,Q as Ke,c as Ye,d as Se,C as W}from"./ClosePopup.3e6b497e.js";import{Q as We}from"./QBtnDropdown.6c4b0624.js";import{Q as Xe}from"./QCardActions.8083bab6.js";import{b as Ze,l as N,B as et,g as X,j as tt,k as at,o as nt,t as ot,D as lt,i as st,h as it,C as ut}from"./DynamsoftButton.fc334862.js";import"./scroll.7c67c206.js";var rt=Ce({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:D,emit:f}){let u=!1,p,m,y=null,C=null,x,S;function g(){p&&p(),p=null,u=!1,y!==null&&(clearTimeout(y),y=null),C!==null&&(clearTimeout(C),C=null),m!==void 0&&m.removeEventListener("transitionend",x),x=null}function w(i,h,L){h!==void 0&&(i.style.height=`${h}px`),i.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,u=!0,p=L}function R(i,h){i.style.overflowY=null,i.style.height=null,i.style.transition=null,g(),h!==S&&f(h)}function P(i,h){let L=0;m=i,u===!0?(g(),L=i.offsetHeight===i.scrollHeight?0:void 0):(S="hide",i.style.overflowY="hidden"),w(i,L,h),y=setTimeout(()=>{y=null,i.style.height=`${i.scrollHeight}px`,x=T=>{C=null,(Object(T)!==T||T.target===i)&&R(i,"show")},i.addEventListener("transitionend",x),C=setTimeout(x,a.duration*1.1)},100)}function E(i,h){let L;m=i,u===!0?g():(S="show",i.style.overflowY="hidden",L=i.scrollHeight),w(i,L,h),y=setTimeout(()=>{y=null,i.style.height=0,x=T=>{C=null,(Object(T)!==T||T.target===i)&&R(i,"hide")},i.addEventListener("transitionend",x),C=setTimeout(x,a.duration*1.1)},100)}return Ie(()=>{u===!0&&g()}),()=>_(Oe,{css:!1,appear:a.appear,onEnter:P,onLeave:E},D.default)}});const A=Qe({}),dt=Object.keys(ke);var Te=Ce({name:"QExpansionItem",props:{...ke,...He,...ze,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...Fe,"click","afterShow","afterHide"],setup(a,{slots:D,emit:f}){const{proxy:{$q:u}}=je(),p=Je(a,u),m=v(a.modelValue!==null?a.modelValue:a.defaultOpened),y=v(null),C=we(),{show:x,hide:S,toggle:g}=$e({showing:m});let w,R;const P=O(()=>`q-expansion-item q-item-type q-expansion-item--${m.value===!0?"expanded":"collapsed"} q-expansion-item--${a.popup===!0?"popup":"standard"}`),E=O(()=>{if(a.contentInsetLevel===void 0)return null;const o=u.lang.rtl===!0?"Right":"Left";return{["padding"+o]:a.contentInsetLevel*56+"px"}}),i=O(()=>a.disable!==!0&&(a.href!==void 0||a.to!==void 0&&a.to!==null&&a.to!=="")),h=O(()=>{const o={};return dt.forEach(B=>{o[B]=a[B]}),o}),L=O(()=>i.value===!0||a.expandIconToggle!==!0),T=O(()=>a.expandedIcon!==void 0&&m.value===!0?a.expandedIcon:a.expandIcon||u.iconSet.expansionItem[a.denseToggle===!0?"denseIcon":"icon"]),K=O(()=>a.disable!==!0&&(i.value===!0||a.expandIconToggle===!0)),V=O(()=>({expanded:m.value===!0,detailsId:a.targetUid,toggle:g,show:x,hide:S})),q=O(()=>{const o=a.toggleAriaLabel!==void 0?a.toggleAriaLabel:u.lang.label[m.value===!0?"collapse":"expand"](a.label);return{role:"button","aria-expanded":m.value===!0?"true":"false","aria-controls":C,"aria-label":o}});me(()=>a.group,o=>{R!==void 0&&R(),o!==void 0&&ne()});function ee(o){i.value!==!0&&g(o),f("click",o)}function te(o){o.keyCode===13&&z(o,!0)}function z(o,B){B!==!0&&y.value!==null&&y.value.focus(),g(o),Pe(o)}function ae(){f("afterShow")}function se(){f("afterHide")}function ne(){w===void 0&&(w=we()),m.value===!0&&(A[a.group]=w);const o=me(m,F=>{F===!0?A[a.group]=w:A[a.group]===w&&delete A[a.group]}),B=me(()=>A[a.group],(F,ge)=>{ge===w&&F!==void 0&&F!==w&&S()});R=()=>{o(),B(),A[a.group]===w&&delete A[a.group],R=void 0}}function ie(){const o={class:[`q-focusable relative-position cursor-pointer${a.denseToggle===!0&&a.switchToggleSide===!0?" items-end":""}`,a.expandIconClass],side:a.switchToggleSide!==!0,avatar:a.switchToggleSide},B=[_(ye,{class:"q-expansion-item__toggle-icon"+(a.expandedIcon===void 0&&m.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:T.value})];return K.value===!0&&(Object.assign(o,{tabindex:0,...q.value,onClick:z,onKeyup:te}),B.unshift(_("div",{ref:y,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),_(H,o,()=>B)}function ue(){let o;return D.header!==void 0?o=[].concat(D.header(V.value)):(o=[_(H,()=>[_($,{lines:a.labelLines},()=>a.label||""),a.caption?_($,{lines:a.captionLines,caption:!0},()=>a.caption):null])],a.icon&&o[a.switchToggleSide===!0?"push":"unshift"](_(H,{side:a.switchToggleSide===!0,avatar:a.switchToggleSide!==!0},()=>_(ye,{name:a.icon})))),a.disable!==!0&&a.hideExpandIcon!==!0&&o[a.switchToggleSide===!0?"unshift":"push"](ie()),o}function re(){const o={ref:"item",style:a.headerStyle,class:a.headerClass,dark:p.value,disable:a.disable,dense:a.dense,insetLevel:a.headerInsetLevel};return L.value===!0&&(o.clickable=!0,o.onClick=ee,Object.assign(o,i.value===!0?h.value:q.value)),_(Z,o,ue)}function de(){return Q(_("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:E.value,id:C},Ae(D.default)),[[qe,m.value]])}function ce(){const o=[re(),_(rt,{duration:a.duration,onShow:ae,onHide:se},de)];return a.expandSeparator===!0&&o.push(_(pe,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:p.value}),_(pe,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:p.value})),o}return a.group!==void 0&&ne(),Ie(()=>{R!==void 0&&R()}),()=>_("div",{class:P.value},[_("div",{class:"q-expansion-item__container relative-position"},ce())])}});const ct={class:"q-pa-md example-row-equal-width"},gt={class:"row"},vt={class:"col-12 col-md",style:{"padding-right":"10px"}},ft=s("div",null,[s("label",{style:{"font-size":"16px"}},"Engines:")],-1),mt={class:"row",style:{"padding-bottom":"20px"}},ht=["value"],bt={style:{"padding-left":"10px"}},xt={class:"row results"},yt={class:"col list"},_t=s("div",{class:"list-header"}," Barcode Results: ",-1),pt={class:"col list"},wt=s("div",{class:"list-header"}," Ground Truth: ",-1),St={class:"col-12 col-md"},Tt={style:{display:"flex"}},It={key:0},kt=s("div",{style:{flex:"1"}},null,-1),Ct={style:{"max-height":"75vh",overflow:"auto"}},Rt=["viewBox"],Lt=["href"],Dt={key:0},Bt=["points"],Nt={key:1},Et=["points","onMousedown"],Ot=["x","y","font-size"],Qt={key:2},qt=["cx","cy"],jt={class:"row"},Pt={class:"dialogs"},Vt=s("div",{class:"text-h6"},"Edit Ground Truth",-1),Gt=s("div",null,[s("label",{for:"ground-truth-format"},"Format:")],-1),Mt=s("div",null,[s("label",{for:"ground-truth-text"},"Text:")],-1),Zt=Ve({__name:"DetailsPage",setup(a){const D=Ge(),f=v(""),u=v(""),p=v(""),m=v([]),y=v(0),C=v(0),x=v(""),S=v([]),g=v([]),w=v(!0),R=v(!0),P=v(!1),E=v(""),i=v([]),h=v(!1),L=v(),T=v([]),K=v(!1),V=v(-1);let q;Me(async()=>{f.value=D.currentRoute.value.params.name,u.value=D.currentRoute.value.params.imageName,p.value=D.currentRoute.value.params.engine;const n=await Ze(D.currentRoute.value.params.name);m.value=n,Ee({title:"Barcode Reading Benchmark - "+f.value+" - "+u.value}),te(),z(D.currentRoute.value.params.engine)});const ee=n=>{let e;n?e=n:e=p.value;for(const t of m.value)if(t.displayName===e)return t},te=async()=>{const n=await N.getItem(f.value+":image:"+u.value);if(n){let e=new Image;e.src=n,e.onload=function(){y.value=e.width,C.value=e.height,x.value=n}}else{const t=await(await fetch("/barcode-dataset/benchmark/dataset/"+f.value+"/"+u.value)).blob();if(t.size>0){const l=await et(t);await N.setItem(f.value+":image:"+u.value,l),te()}}},z=async(n,e)=>{let t;if(n?t=n:t=p.value,e)S.value=e.results;else{const k=await N.getItem(f.value+":detectionResult:"+X(u.value)+"-"+t+".json");k?(e=JSON.parse(k),e&&(S.value=e.results)):S.value=[]}const l=await N.getItem(f.value+":groundTruth:"+X(u.value)+".txt");let I;l&&(I=JSON.parse(l),g.value=I),e&&l&&ie(e.results,I)},ae=n=>{let e=n.x1+","+n.y1+" ";return e=e+n.x2+","+n.y2+" ",e=e+n.x3+","+n.y3+" ",e=e+n.x4+","+n.y4,e},se=async()=>{try{const n=ee();if(n){let e=n.engine,t=n.displayName,l=!1;q?q.getEngine()!=e&&(l=!0):l=!0,l&&(E.value="Initializing...",q=await st.createInstance(e),E.value=""),await ne();const I=await N.getItem(f.value+":image:"+u.value);if(I){E.value="Decoding...";let k=await q.detect(I);E.value="",console.log(k),S.value=k.results,P.value===!0&&await N.setItem(f.value+":detectionResult:"+X(u.value)+"-"+t+".json",JSON.stringify(k)),z(t,k)}}}catch(n){alert(n+`
Please check if the local barcode reading server is running.`)}},ne=async()=>{const n=ee();if(n){const e=n.settings;await q.setSupportedSettings(e)}},ie=(n,e)=>{let t=[];for(let l=0;l<n.length;l++){const I=n[l];let k=!1;for(let G=0;G<e.length;G++){const oe=e[G];let ve;if(oe.hasLocation===!1)ve=1;else{const Be=tt(I),Ne=at(oe);ve=nt(Be,Ne)}if(ve>.2){oe.text&&(ot(oe,I)?k=!0:t.push(l));break}G===e.length-1&&k===!1&&t.push(l)}}i.value=t},ue=n=>{p.value=n,z(n)},re=async()=>{N.removeItem(f.value+":image:"+u.value),N.removeItem(f.value+":groundTruth:"+X(u.value)+".txt");const n=await N.getItem("projects");if(n){const e=JSON.parse(n);for(let t=0;t<e.length;t++)if(e[t].info.name===f.value){const l=e[t],I=[];for(let k=0;k<l.info.images.length;k++){const G=l.info.images[k];G!=u.value&&I.push(G)}l.info.images=I}await N.setItem("projects",JSON.stringify(e)),alert("deleted")}},de=()=>{if(x.value){const n=it(x.value),e=document.createElement("a");e.href=URL.createObjectURL(n),e.download=u.value,document.body.appendChild(e),e.click(),document.body.removeChild(e)}else alert("The image has not been downloaded.")},ce=()=>{h.value=!h.value},o=()=>{g.value=ut(S.value)},B=async()=>{await N.setItem(f.value+":groundTruth:"+X(u.value)+".txt",JSON.stringify(g.value)),alert("Saved")},F=n=>(n.preventDefault(),!1),ge=(n,e)=>{let t=1;return t=y.value/L.value.clientWidth,{x:Math.floor(t*n),y:Math.floor(t*e)}},Re=(n,e)=>{h.value&&(n.stopPropagation(),V.value=e,K.value=!0)},Le=n=>{if(h.value){const e=[];if(T.value.forEach(t=>{e.push(t)}),n.button==2)n.preventDefault(),e.pop();else if(e.push(ge(n.offsetX,n.offsetY)),e.length>=4){De(e);return}T.value=e}},De=n=>{const e=[],t={x1:n[0].x,x2:n[1].x,x3:n[2].x,x4:n[3].x,y1:n[0].y,y2:n[1].y,y3:n[2].y,y4:n[3].y,text:"",attrib:{Type:""},value_attrib:{}};g.value.forEach(l=>{e.push(l)}),e.push(t),g.value=e,T.value=[]};return(n,e)=>(r(),b("div",ct,[s("div",gt,[s("div",vt,[ft,s("div",mt,[Q(s("select",{"onUpdate:modelValue":[e[0]||(e[0]=t=>p.value=t),e[1]||(e[1]=t=>ue(t))],style:{"min-width":"200px"}},[(r(!0),b(M,null,U(m.value,t=>(r(),b("option",{value:t.displayName,key:"engine-"+t.displayName},j(t.displayName),9,ht))),128))],512),[[Ue,p.value]])]),s("div",null,[d(lt,{label:"Decode",onClick:se}),d(fe,{modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=t=>P.value=t),label:"Save Detection Results"},null,8,["modelValue"]),s("span",bt,j(E.value),1)]),s("div",null,[d(fe,{style:{"margin-right":"5px"},color:"orange",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),label:"Show Detection Results"},null,8,["modelValue"]),d(fe,{color:"orange",modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=t=>R.value=t),label:"Show Ground Trurh"},null,8,["modelValue"])]),s("div",xt,[s("div",yt,[_t,d(he,{bordered:"",class:"rounded-borders"},{default:c(()=>[(r(!0),b(M,null,U(S.value,(t,l)=>(r(),J(Te,{class:be(i.value.indexOf(l)!=-1?"incorrect":"correct"),"switch-toggle-side":"","dense-toggle":"",label:l.toString()+": "+t.barcodeText,key:l},{default:c(()=>[s("pre",null,""+j(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["class","label"]))),128))]),_:1})]),s("div",pt,[wt,d(he,{bordered:"",class:"rounded-borders"},{default:c(()=>[(r(!0),b(M,null,U(g.value,(t,l)=>(r(),J(Te,{"switch-toggle-side":"","dense-toggle":"",label:l.toString()+": "+t.text,key:l},{default:c(()=>[s("pre",null,""+j(JSON.stringify(t,null,4))+`
                `,1)]),_:2},1032,["label"]))),128))]),_:1})])])]),s("div",St,[s("div",Tt,[x.value?Y("",!0):(r(),b("div",It,"Downloading... ")),kt,s("div",null,[d(We,{color:"black",label:"Action"},{default:c(()=>[d(he,null,{default:c(()=>[Q((r(),J(Z,{clickable:"",onClick:de},{default:c(()=>[d(H,null,{default:c(()=>[d($,null,{default:c(()=>[le("Save the image")]),_:1})]),_:1})]),_:1})),[[W]]),Q((r(),J(Z,{clickable:"",onClick:ce},{default:c(()=>[d(H,null,{default:c(()=>[d($,null,{default:c(()=>[le(j(h.value?"Disable":"Enable")+" annotation",1)]),_:1})]),_:1})]),_:1})),[[W]]),Q((r(),J(Z,{clickable:"",onClick:o},{default:c(()=>[d(H,null,{default:c(()=>[d($,null,{default:c(()=>[le("Convert detected results to ground truth")]),_:1})]),_:1})]),_:1})),[[W]]),Q((r(),J(Z,{clickable:"",onClick:B},{default:c(()=>[d(H,null,{default:c(()=>[d($,null,{default:c(()=>[le("Save modified ground truth")]),_:1})]),_:1})]),_:1})),[[W]])]),_:1})]),_:1})])]),s("div",Ct,[x.value?(r(),b("svg",{key:0,viewBox:"0 0 "+y.value+" "+C.value,ref_key:"svgRef",ref:L,class:be("fade"+(h.value?" annotator":"")),onContextmenu:e[5]||(e[5]=t=>F(t)),onMousedown:e[6]||(e[6]=t=>Le(t))},[s("image",{href:x.value},null,8,Lt),w.value?(r(),b("a",Dt,[(r(!0),b(M,null,U(S.value,(t,l)=>(r(),b("polygon",{key:"polygon"+l,points:ae(t),class:"barcode-polygon"},[s("title",null,j(t.barcodeFormat+": "+t.barcodeText),1)],8,Bt))),128))])):Y("",!0),R.value?(r(),b("a",Nt,[(r(!0),b(M,null,U(g.value,(t,l)=>(r(),b("polygon",{key:"polygon"+l,points:ae(t),class:"groundtruth-polygon",onMousedown:I=>Re(I,l)},[s("title",null,j(t.attrib.Type+": "+t.text),1)],40,Et))),128)),(r(!0),b(M,null,U(g.value,(t,l)=>(r(),b("text",{key:"text"+l,x:t.x1,y:t.y1,"font-size":16/(640/y.value),class:"barcodeTypeLabel"},j(t.attrib.Type),9,Ot))),128))])):Y("",!0),h.value?(r(),b("a",Qt,[(r(!0),b(M,null,U(T.value,(t,l)=>(r(),b("circle",{key:"point"+l,cx:t.x,cy:t.y},null,8,qt))),128))])):Y("",!0)],42,Rt)):Y("",!0)])])]),s("div",jt,[d(_e,{outline:"",color:"red",label:"Delete this image",onClick:re})]),s("div",Pt,[d(Ke,{modelValue:K.value,"onUpdate:modelValue":e[9]||(e[9]=t=>K.value=t)},{default:c(()=>[d(Ye,null,{default:c(()=>[d(Se,null,{default:c(()=>[Vt]),_:1}),d(Se,{class:"q-pt-none"},{default:c(()=>[s("div",null,[Gt,s("div",null,[Q(s("input",{type:"text",id:"'ground-truth-format","onUpdate:modelValue":e[7]||(e[7]=t=>g.value[V.value].attrib.Type=t)},null,512),[[xe,g.value[V.value].attrib.Type]])]),Mt,s("div",null,[Q(s("textarea",{id:"'ground-truth-text","onUpdate:modelValue":e[8]||(e[8]=t=>g.value[V.value].text=t)},null,512),[[xe,g.value[V.value].text]])])])]),_:1}),d(Xe,{align:"right"},{default:c(()=>[Q(d(_e,{flat:"",color:"primary",label:"Close"},null,512),[[W]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}});export{Zt as default};
